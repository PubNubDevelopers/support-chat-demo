{"version":3,"sources":["core/components/cryptography/index.js"],"names":["config","_config","_iv","_allowedKeyEncodings","_allowedKeyLengths","_allowedModes","_defaultOptions","encryptKey","keyEncoding","keyLength","mode","data","hash","CryptoJS","HmacSHA256","secretKey","toString","enc","Base64","s","SHA256","Hex","incomingOptions","options","hasOwnProperty","indexOf","toLowerCase","parseInt","key","parse","_decodeKey","Utf8","slice","ECB","CBC","customCipherKey","customEncrypt","pnEncrypt","customDecrypt","pnDecrypt","cipherKey","_parseOptions","iv","_getIV","_getMode","_getPaddedKey","encryptedHexArray","AES","encrypt","ciphertext","base64Encrypted","plainJSON","decrypt","plaintext","JSON","e"],"mappings":"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","sourcesContent":["/* @flow */\n\nimport Config from '../config';\nimport CryptoJS from './hmac-sha256';\n\ntype CryptoConstruct = {\n  config: Config,\n}\n\nexport default class {\n  _config: Config;\n  _iv: string;\n  _allowedKeyEncodings: Array<string>;\n  _allowedKeyLengths: Array<number>;\n  _allowedModes: Array<string>;\n  _defaultOptions: Object;\n\n  constructor({ config }: CryptoConstruct) {\n    this._config = config;\n\n    this._iv = '0123456789012345';\n\n    this._allowedKeyEncodings = ['hex', 'utf8', 'base64', 'binary'];\n    this._allowedKeyLengths = [128, 256];\n    this._allowedModes = ['ecb', 'cbc'];\n\n    this._defaultOptions = {\n      encryptKey: true,\n      keyEncoding: 'utf8',\n      keyLength: 256,\n      mode: 'cbc'\n    };\n  }\n\n  HMACSHA256(data: string): string {\n    let hash = CryptoJS.HmacSHA256(data, this._config.secretKey);\n    return hash.toString(CryptoJS.enc.Base64);\n  }\n\n  SHA256(s: string): string {\n    return CryptoJS.SHA256(s).toString(CryptoJS.enc.Hex);\n  }\n\n  _parseOptions(incomingOptions: ?Object): Object {\n    // Defaults\n    let options = incomingOptions || {};\n    if (!options.hasOwnProperty('encryptKey')) options.encryptKey = this._defaultOptions.encryptKey;\n    if (!options.hasOwnProperty('keyEncoding')) options.keyEncoding = this._defaultOptions.keyEncoding;\n    if (!options.hasOwnProperty('keyLength')) options.keyLength = this._defaultOptions.keyLength;\n    if (!options.hasOwnProperty('mode')) options.mode = this._defaultOptions.mode;\n\n    // Validation\n    if (this._allowedKeyEncodings.indexOf(options.keyEncoding.toLowerCase()) === -1) {\n      options.keyEncoding = this._defaultOptions.keyEncoding;\n    }\n\n    if (this._allowedKeyLengths.indexOf(parseInt(options.keyLength, 10)) === -1) {\n      options.keyLength = this._defaultOptions.keyLength;\n    }\n\n    if (this._allowedModes.indexOf(options.mode.toLowerCase()) === -1) {\n      options.mode = this._defaultOptions.mode;\n    }\n\n    return options;\n  }\n\n  _decodeKey(key: string, options: Object): string {\n    if (options.keyEncoding === 'base64') {\n      return CryptoJS.enc.Base64.parse(key);\n    } else if (options.keyEncoding === 'hex') {\n      return CryptoJS.enc.Hex.parse(key);\n    } else {\n      return key;\n    }\n  }\n\n  _getPaddedKey(key: string, options: Object): string {\n    key = this._decodeKey(key, options);\n    if (options.encryptKey) {\n      return CryptoJS.enc.Utf8.parse(this.SHA256(key).slice(0, 32));\n    } else {\n      return key;\n    }\n  }\n\n  _getMode(options: Object): string {\n    if (options.mode === 'ecb') {\n      return CryptoJS.mode.ECB;\n    } else {\n      return CryptoJS.mode.CBC;\n    }\n  }\n\n  _getIV(options: Object): string | null {\n    return (options.mode === 'cbc') ? CryptoJS.enc.Utf8.parse(this._iv) : null;\n  }\n\n  encrypt(data: string, customCipherKey: ?string, options: ?Object): Object | string | null {\n    if (this._config.customEncrypt) {\n      return this._config.customEncrypt(data);\n    } else {\n      return this.pnEncrypt(data, customCipherKey, options);\n    }\n  }\n\n  decrypt(data: Object, customCipherKey: ?string, options: ?Object): Object | string | null {\n    if (this._config.customDecrypt) {\n      return this._config.customDecrypt(data);\n    } else {\n      return this.pnDecrypt(data, customCipherKey, options);\n    }\n  }\n\n  pnEncrypt(data: string, customCipherKey: ?string, options: ?Object): Object | string | null {\n    if (!customCipherKey && !this._config.cipherKey) return data;\n    options = this._parseOptions(options);\n    let iv = this._getIV(options);\n    let mode = this._getMode(options);\n    let cipherKey = this._getPaddedKey(customCipherKey || this._config.cipherKey, options);\n    let encryptedHexArray = CryptoJS.AES.encrypt(data, cipherKey, { iv, mode }).ciphertext;\n    let base64Encrypted = encryptedHexArray.toString(CryptoJS.enc.Base64);\n    return base64Encrypted || data;\n  }\n\n  pnDecrypt(data: Object, customCipherKey: ?string, options: ?Object): Object | null {\n    if (!customCipherKey && !this._config.cipherKey) return data;\n    options = this._parseOptions(options);\n    let iv = this._getIV(options);\n    let mode = this._getMode(options);\n    let cipherKey = this._getPaddedKey(customCipherKey || this._config.cipherKey, options);\n    try {\n      let ciphertext = CryptoJS.enc.Base64.parse(data);\n      let plainJSON = CryptoJS.AES.decrypt({ ciphertext }, cipherKey, { iv, mode }).toString(CryptoJS.enc.Utf8);\n      let plaintext = JSON.parse(plainJSON);\n      return plaintext;\n    } catch (e) {\n      return null;\n    }\n  }\n}\n"],"file":"index.js"}