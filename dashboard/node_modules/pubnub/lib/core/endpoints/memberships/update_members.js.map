{"version":3,"sources":["core/endpoints/memberships/update_members.js"],"names":["prepareMessagePayload","modules","incomingParams","addMembers","updateMembers","removeMembers","users","payload","length","add","forEach","addMember","currentAdd","id","custom","push","update","updateMember","currentUpdate","remove","removeMemberId","getOperation","operationConstants","PNUpdateMembersOperation","validateParams","spaceId","getURL","config","subscribeKey","patchURL","usePatch","getRequestTimeout","getTransactionTimeout","isAuthSupported","getAuthToken","token","tokenManager","getToken","prepareParams","include","limit","page","params","includes","totalCount","count","customFields","spaceFields","customSpaceFields","includesString","join","next","start","prev","end","patchPayload","handleResponse","membersResponse"],"mappings":"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","sourcesContent":["/* @flow */\n\nimport {\n  AddMembers,\n  UpdateMembers,\n  MembersInput,\n  MembersListResponse,\n  ModulesInject,\n} from '../../flow_interfaces';\nimport operationConstants from '../../constants/operations';\n\nfunction prepareMessagePayload(modules, incomingParams) {\n  const { addMembers, updateMembers, removeMembers, users } = incomingParams;\n  let payload = {};\n\n  if (addMembers && addMembers.length > 0) {\n    payload.add = [];\n\n    addMembers.forEach((addMember) => {\n      let currentAdd: AddMembers = { id: addMember.id };\n\n      if (addMember.custom) {\n        currentAdd.custom = addMember.custom;\n      }\n\n      payload.add.push(currentAdd);\n    });\n  }\n\n  if (updateMembers && updateMembers.length > 0) {\n    payload.update = [];\n\n    updateMembers.forEach((updateMember) => {\n      let currentUpdate: UpdateMembers = { id: updateMember.id };\n\n      if (updateMember.custom) {\n        currentUpdate.custom = updateMember.custom;\n      }\n\n      payload.update.push(currentUpdate);\n    });\n  }\n\n  // if users is present then it is an update\n  if (users && users.length > 0) {\n    payload.update = payload.update || [];\n\n    users.forEach((updateMember) => {\n      let currentUpdate: UpdateMembers = { id: updateMember.id };\n\n      if (updateMember.custom) {\n        currentUpdate.custom = updateMember.custom;\n      }\n\n      payload.update.push(currentUpdate);\n    });\n  }\n\n  if (removeMembers && removeMembers.length > 0) {\n    payload.remove = [];\n\n    removeMembers.forEach((removeMemberId) => {\n      payload.remove.push({ id: removeMemberId });\n    });\n  }\n\n  return payload;\n}\n\nexport function getOperation(): string {\n  return operationConstants.PNUpdateMembersOperation;\n}\n\nexport function validateParams(\n  modules: ModulesInject,\n  incomingParams: MembersInput\n) {\n  let { spaceId, users } = incomingParams;\n\n  if (!spaceId) return 'Missing spaceId';\n  if (!users) return 'Missing users';\n}\n\nexport function getURL(\n  modules: ModulesInject,\n  incomingParams: MembersInput\n): string {\n  let { config } = modules;\n\n  return `/v1/objects/${config.subscribeKey}/spaces/${incomingParams.spaceId}/users`;\n}\n\nexport function patchURL(\n  modules: ModulesInject,\n  incomingParams: MembersInput\n): string {\n  let { config } = modules;\n\n  return `/v1/objects/${config.subscribeKey}/spaces/${incomingParams.spaceId}/users`;\n}\n\nexport function usePatch() {\n  return true;\n}\n\nexport function getRequestTimeout({ config }: ModulesInject) {\n  return config.getTransactionTimeout();\n}\n\nexport function isAuthSupported() {\n  return true;\n}\n\nexport function getAuthToken(modules: ModulesInject, incomingParams: MembersInput): string {\n  let token =\n    modules.tokenManager.getToken('space', incomingParams.spaceId) ||\n    modules.tokenManager.getToken('space');\n\n  return token;\n}\n\nexport function prepareParams(\n  modules: ModulesInject,\n  incomingParams: MembersInput\n): Object {\n  const { include, limit, page } = incomingParams;\n  const params = {};\n\n  if (limit) {\n    params.limit = limit;\n  }\n\n  if (include) {\n    let includes = [];\n\n    if (include.totalCount) {\n      params.count = true;\n    }\n\n    if (include.customFields) {\n      includes.push('custom');\n    }\n\n    if (include.spaceFields) {\n      includes.push('space');\n    }\n\n    if (include.customSpaceFields) {\n      includes.push('space.custom');\n    }\n\n    let includesString = includes.join(',');\n\n    if (includesString.length > 0) {\n      params.include = includesString;\n    }\n  }\n\n  if (page) {\n    if (page.next) {\n      params.start = page.next;\n    }\n    if (page.prev) {\n      params.end = page.prev;\n    }\n  }\n\n  return params;\n}\n\nexport function patchPayload(\n  modules: ModulesInject,\n  incomingParams: MembersInput\n): Object {\n  return prepareMessagePayload(modules, incomingParams);\n}\n\nexport function handleResponse(\n  modules: ModulesInject,\n  membersResponse: Object\n): MembersListResponse {\n  return membersResponse;\n}\n"],"file":"update_members.js"}